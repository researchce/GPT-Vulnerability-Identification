import csv

def filter_and_summarize_cve(input_file_path, output_file_path):
    # Read the CSV file
    with open(input_file_path, 'r', newline='', encoding='utf-8-sig') as input_file:
        reader = csv.reader(input_file)
        header = next(reader)  # Read the header

        # Filter lines based on CVE names starting with "CVE-2023-"
        filtered_lines = [line for line in reader if line and line[0].startswith("CVE-2023-")]

    # Write filtered lines to a new CSV file
    with open(output_file_path, 'w', newline='', encoding='utf-8') as output_file:
        writer = csv.writer(output_file)
        writer.writerow(header)  # Write the header
        writer.writerows(filtered_lines)

    # Calculate summary
    total_items = sum(1 for line in csv.reader(open(input_file_path, 'r', newline='', encoding='utf-8-sig')))
    removed_items = total_items - len(filtered_lines)
    kept_items = len(filtered_lines)

    # Return summary
    return {
        'total_items': total_items,
        'removed_items': removed_items,
        'kept_items': kept_items
    }

# Example usage:
input_file_path = 'cves/allitems.csv'
output_file_path = 'cves/2023_cves.csv'
summary = filter_and_summarize_cve(input_file_path, output_file_path)
print(summary)
