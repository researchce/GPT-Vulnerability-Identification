import os
import json
from datetime import datetime

"""
This script merges multiple JSON files containing CVE data from a specified input directory
into a single JSON file. The resulting merged JSON file is saved with a timestamp in the filename.

Functions:
- merge_json_files(input_dir, output_name): Iterates through all JSON files in the input directory,
  loads their data, combines them into a single dictionary, and writes the merged data to an output
  JSON file with a timestamp in the filename.

Usage:
- Specify the input directory containing the JSON files and the desired output filename.
- Call the merge_json_files function with these parameters.
"""

def merge_json_files(input_dir, output_name):
    # List to store all data from JSON files
    all_cves = {"cves": []}

    # Iterate over all files in the input directory
    for filename in os.listdir(input_dir):
        if filename.endswith(".json"):
            filepath = os.path.join(input_dir, filename)
            with open(filepath, 'r') as file:
                # Load data from the current JSON file
                cves_data = json.load(file)
                # Add the data to the main dictionary
                all_cves["cves"].extend(cves_data["cves"])

    # Generate the output file name with a timestamp
    timestamp = datetime.now().strftime("%Y%m%d%H%M%S")
    output_filename = f"{output_name}-{timestamp}.json"

    # Write the merged data to an output JSON file
    with open(output_filename, 'w') as outfile:
        json.dump(all_cves, outfile, indent=4)

# Example usage
input_directory = "/Users/andresvargasrivera/repos/cve-automations/open_ai_api/results/content"
output_filename = "merged_results_2023_1"

merge_json_files(input_directory, output_filename)
